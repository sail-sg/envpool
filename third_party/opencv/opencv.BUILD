load("@rules_foreign_cc//foreign_cc:defs.bzl", "cmake")

filegroup(
    name = "srcs",
    srcs = glob(["**"]),
    visibility = ["//visibility:public"],
)

# Shows a standard library using the Ninja generator
cmake(
    name = "opencv",
    generate_args = [
        "-GNinja",
        "-DBUILD_SHARED_LIBS=OFF",
        "-DBUILD_EXAMPLES=OFF",
        "-DBUILD_opencv_apps=OFF",
        "-DBUILD_opencv_calib3d=OFF",
        "-DBUILD_opencv_core=ON",
        "-DBUILD_opencv_features2d=ON",
        "-DBUILD_opencv_flann=ON",
        "-DBUILD_opencv_gapi=ON",
        "-DBUILD_opencv_highgui=OFF",
        "-DBUILD_opencv_imgcodecs=OFF",
        "-DBUILD_opencv_imgproc=ON",
        "-DBUILD_opencv_java_bindings_generator=OFF",
        "-DBUILD_opencv_js=OFF",
        "-DBUILD_opencv_js_bindings_generator=OFF",
        "-DBUILD_opencv_ml=OFF",
        "-DBUILD_opencv_objc_bindings_generator=OFF",
        "-DBUILD_opencv_objdetect=OFF",
        "-DBUILD_opencv_photo=OFF",
        "-DBUILD_opencv_python3=OFF",
        "-DBUILD_opencv_python_bindings_generator=OFF",
        "-DBUILD_opencv_python_tests=OFF",
        "-DBUILD_opencv_stitching=OFF",
        "-DBUILD_opencv_ts=OFF",
        "-DBUILD_opencv_video=OFF",
        "-DBUILD_opencv_videoio=OFF",
        "-DBUILD_opencv_world=OFF",
        "-DWITH_CUDA=OFF",
        "-DWITH_EIGEN=ON",
        "-DWITH_FFMPEG=ON",
        "-DWITH_GTK=OFF",
        "-DWITH_GTK_2_X=OFF",
        "-DWITH_IPP=OFF",
        "-DWITH_ITT=OFF",
        "-DWITH_JASPER=ON",
        "-DWITH_JPEG=ON",
        "-DWITH_LAPACK=ON",
        "-DWITH_ONNX=OFF",
        "-DWITH_OPENCL=OFF",
        "-DWITH_OPENGL=OFF",
        "-DWITH_OPENJPEG=OFF",
        "-DWITH_PLAIDML=OFF",
        "-DWITH_PNG=OFF",
        "-DWITH_PROTOBUF=OFF",
        "-DWITH_PTHREADS_PF=ON",
        "-DWITH_QT=OFF",
        "-DWITH_TBB=OFF",
        "-DWITH_TIFF=OFF",
    ],
    lib_source = ":srcs",
    linkopts = [
        "-ldl",
    ],
    out_include_dir = "include/opencv4",
    out_static_libs = [
        "libopencv_imgproc.a",
        "libopencv_features2d.a",
        "libopencv_flann.a",
        "libopencv_core.a",
    ],
    visibility = ["//visibility:public"],
)
